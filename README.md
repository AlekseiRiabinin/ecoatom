# "API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É—á–µ—Ç–∞ –æ—Ç—Ö–æ–¥–æ–≤ –∞—Ç–æ–º —ç–∫–æ" (Ecoatom)

## 1. [–û–ø–∏—Å–∞–Ω–∏–µ](#1)
## 2. [–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API](#2)
## 3. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#3)
## 4. [–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞](#4)
## 5. [–†–∞–±–æ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#5)
## 6. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#6)
## 7. [–û–± –∞–≤—Ç–æ—Ä–µ](#7)

---
## 1. –û–ø–∏—Å–∞–Ω–∏–µ <a id=1></a>

–ü—Ä–æ–µ–∫—Ç "A—Ç–æ–º —ç–∫–æ" (Ecoatom) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
  - –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—â–∏—Ö –æ—Ç—Ö–æ–¥—ã (–±–∏–æ–æ—Ç—Ö–æ–¥—ã, —Å—Ç–µ–∫–ª–æ, –ø–ª–∞—Å—Ç–∏–∫)
  - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
  - –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –æ—Ç—Ö–æ–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞
  - –≤—ã–≤–æ–¥–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞–º–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—Ç—Ö–æ–¥–æ–≤
  - –≤—ã–ø–æ–ª–Ω—è—Ç—å unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ API c –ø–æ–º–æ—â—å—é pytest
  - –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ docker-compose

---
## 2. –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API <a id=2></a>

* http://127.0.0.1:8000/x/ (POST): –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â.
```python
{
    "key": "x",
    "val": 1000
}
```

* http://127.0.0.1:8000/database/ (GET): –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ä–∞–Ω–∏–∑–∞—Ü–∏—è—Ö –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
```python
{
    "source1":{
        "name": "source1",
        "plastic": 100,
        "glass": 20,
        "biowaste": 20
    },
    "source2":{
        "name": "source2",
        "plastic": 20,
        "glass": 50,
        "biowaste": 20
    },
    "storage1":{
        "name":"storage1",
        "max_plastic": 20,
        "max_glass": 0,
        "max_biowaste": 10,
        "plastic": 20,
        "glass": 0,
        "biowaste": 6
    },
    "storage2":{
        "name": "storage2",
        "max_plastic": 10,
        "max_glass": 5,
        "max_biowaste": 0,
        "plastic": 10,
        "glass": 3,
        "biowaste": 0
    },
    "x": 1000,
}
```

* http://127.0.0.1:8000/storage/ (POST): –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö.
```python
{
    "Empty field"
}
```

---

## 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö <a id=3></a>

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Redis, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å –ø–∞—Ä ¬´key-value¬ª, –≥–¥–µ –∫–ª—é—á —Å–ª—É–∂–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º.

–î–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–∞–∫ —Å–ª–æ–≤–∞—Ä–µ–º (dict) –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±—Ç–±–ª–∏–æ—Ç–µ–∫–∞ RedisDict. –ï–µ —Ü–µ–ª—å ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö Python, –∏—Å–ø–æ–ª—å–∑—É—è Redis –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ—à–µ–Ω–∏—è  –¥–ª—è –±–µ—Å—à–æ–≤–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

–ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –≤—ã–¥–µ–ª–µ–Ω –ø–æ—Ä—Ç 6379, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º –ø–æ—Ä—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—É.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ docker-compose.yml):
```bash
REDIS_HOST=redis
REDIS_PORT=6379
```

---

## 4. –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ <a id=4></a>

–í –Ω–∞—á–∞–ª–µ —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å Docker Daemon.

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:
```bash
git clone https://github.com/AlekseiRiabinin/ecoatom.git
```

–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:
```bash
cd ecoatom
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (Redis –∏ Web):
```bash
docker-compose build
```

–ò –ø–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```bash
docker-compose up -d
```

---

## 5. –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º <a id=5></a>

–î–∞–ª–µ–µ —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –¥–≤—É—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö: Terminal 1 - –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, Terminal 2 - –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º Web.

(Terminal 1). –° –ø–æ–º–æ—â—å—é POST –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é "x", –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ—Ç—Ö–æ–¥–æ–≤ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö:
```bash
curl -X POST "http://127.0.0.1:8000/x/" -H "Content-Type: application/json" -d '{"key": "x", "val": 1000}'
```

(Terminal 2). –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∑–∞–π—Ç–∏ –≤ Docker-–∫–æ–Ω—Ç–µ–Ω–µ—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—â–µ–Ω–æ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
docker-compose exec web sh 
```

(Terminal 2). –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–π –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —Ä–∞–∑–º–µ—Ä—ã –æ—Ç—Ö–æ–¥–æ–≤, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—â–∏–µ –∫–∞–∂–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ "x":
```bash
python -s utils/fill_redis_db.py 
```

(Terminal 1). –°–¥–µ–ª–∞—Ç—å GET –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```bash
curl -X 'GET' 'http://127.0.0.1:8000/database/' -H 'accept: application/json'
```

(Terminal 1). –°–¥–µ–ª–∞—Ç—å POST –∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç "storage" –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â, –∞ —Ç–∞–∫–∂–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞–∏–±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º –¥–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –∏ –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```bash
curl -X POST "http://127.0.0.1:8000/storage/" -H "Content-Type: application/json"
```

(Terminal 2). –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–π –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç—Ö–æ–¥–æ–≤ –ø–æ –∫–∞–∂–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É:
```bash
python -s utils/print_redis_db.py
```

(Terminal 2). –í—ã–ø–æ–ª–Ω–∏—Ç—å unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º:
```bash
pytest -v
```

(Terminal 2). –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
python -s utils/clear_redis_db.py
```

(Terminal 1). –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
docker-compose down
```

---

## 6. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è <a id=6></a>

–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π: Python 3, FastAPI, pydantic, pytest, Docker, Redis, uvicorn.

API —Ñ—Ä–µ–π–º–≤–æ—Ä–∫: FastAPI (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä web)  
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: Redis (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä redis)

–í–µ–±-—Å–µ—Ä–≤–µ—Ä uvicorn –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç API-–∑–∞–ø—Ä–æ—Å—ã –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É web, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö redis —á–µ—Ä–µ–∑ docker-network.  

---

## 7. –û–± –∞–≤—Ç–æ—Ä–µ <a id=7></a>

Aleksei Riabinin üìß Telegram: @alexxflames

üîó GitHub: github.com/AlekseiRiabinin
üîó LinkedIn: linkedin.com/in/aleksei-riabinin-08b0b9100
